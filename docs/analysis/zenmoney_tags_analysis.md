# –ê–Ω–∞–ª–∏–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ç–µ–≥–æ–≤ (—Å—Ç–∞—Ç–µ–π) ZenMoney

## üìã –û–±–∑–æ—Ä

–ù–∞ –æ—Å–Ω–æ–≤–µ –∞–Ω–∞–ª–∏–∑–∞ API ZenMoney –∏ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏–∑ `zenmoney_response.json` –∏ `zenmoney_dictionaries.json` –±—ã–ª–∞ –∏–∑—É—á–µ–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ–≥–æ–≤ (—Å—Ç–∞—Ç–µ–π) –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–∞ —Å—Ö–µ–º–∞ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –≤ Supabase.

## üîç –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö —Ç–µ–≥–æ–≤

### –û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–ª—è –∏–∑ API ZenMoney

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ | –ü—Ä–∏–º–µ—Ä |
|------|-----|----------|---------|
| `id` | UUID | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Ç–µ–≥–∞ | `"08a38928-caa9-449e-b108-be0410a7935d"` |
| `user` | Integer | ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ZenMoney | `1695996` |
| `title` | String | –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–µ–≥–∞/—Å—Ç–∞—Ç—å–∏ | `"–í–∏–¥–µ–æ –∏–≥—Ä—ã"` |
| `parent` | UUID | ID —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ —Ç–µ–≥–∞ (–¥–ª—è –∏–µ—Ä–∞—Ä—Ö–∏–∏) | `"a1bcf4a5-9244-4196-a2a1-d036492d8047"` |
| `color` | Integer | –¶–≤–µ—Ç —Ç–µ–≥–∞ –≤ —á–∏—Å–ª–æ–≤–æ–º —Ñ–æ—Ä–º–∞—Ç–µ | `4287730330` |
| `icon` | String | –ò–∫–æ–Ω–∫–∞ —Ç–µ–≥–∞ | `"2007_controller"` |
| `picture` | String/null | –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–µ–≥–∞ | `null` |
| `staticId` | String/null | –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π ID —Ç–µ–≥–∞ | `"2006"` –∏–ª–∏ `null` |
| `changed` | Timestamp | –í—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è | `1743819611` |

### –ë—É–ª–µ–≤—ã–µ —Ñ–ª–∞–≥–∏

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ | –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é |
|------|-----|----------|----------------------|
| `budgetIncome` | Boolean | –£—á–∏—Ç—ã–≤–∞—Ç—å –≤ –±—é–¥–∂–µ—Ç–µ –¥–æ—Ö–æ–¥–æ–≤ | `false` |
| `budgetOutcome` | Boolean | –£—á–∏—Ç—ã–≤–∞—Ç—å –≤ –±—é–¥–∂–µ—Ç–µ —Ä–∞—Å—Ö–æ–¥–æ–≤ | `false` |
| `required` | Boolean | –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π —Ç–µ–≥ (–Ω–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å) | `false` |
| `archive` | Boolean | –ê—Ä—Ö–∏–≤–Ω—ã–π —Å—Ç–∞—Ç—É—Å | `false` |
| `showIncome` | Boolean | –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –≤ –¥–æ—Ö–æ–¥–∞—Ö | `false` |
| `showOutcome` | Boolean | –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –≤ —Ä–∞—Å—Ö–æ–¥–∞—Ö | `true` |

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–∞–Ω–Ω—ã—Ö

- **–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–µ–≥–æ–≤**: 91
- **–¢–µ–≥–∏ —Å —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–º–∏ —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏**: ~70% (–∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞)
- **–ê—Ä—Ö–∏–≤–Ω—ã–µ —Ç–µ–≥–∏**: ~5%
- **–¢–µ–≥–∏ —Å –∏–∫–æ–Ω–∫–∞–º–∏**: ~80%
- **–¢–µ–≥–∏ —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏**: ~2%

## üóÑÔ∏è –°—Ö–µ–º–∞ Supabase

### –¢–∞–±–ª–∏—Ü–∞ `zm_tags`

```sql
CREATE TABLE zm_tags (
    -- –û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–ª—è
    id UUID PRIMARY KEY,                    -- –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Ç–µ–≥–∞
    user_id INTEGER NOT NULL,               -- ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ZenMoney
    title TEXT NOT NULL,                    -- –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–µ–≥–∞/—Å—Ç–∞—Ç—å–∏
    parent_id UUID REFERENCES zm_tags(id), -- ID —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ —Ç–µ–≥–∞
    
    -- –í–∏–∑—É–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
    color INTEGER,                          -- –¶–≤–µ—Ç —Ç–µ–≥–∞ (—á–∏—Å–ª–æ–≤–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ)
    icon TEXT,                              -- –ò–∫–æ–Ω–∫–∞ —Ç–µ–≥–∞
    picture TEXT,                           -- –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–µ–≥–∞
    
    -- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
    show_income BOOLEAN DEFAULT false,      -- –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –≤ –¥–æ—Ö–æ–¥–∞—Ö
    show_outcome BOOLEAN DEFAULT true,      -- –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –≤ —Ä–∞—Å—Ö–æ–¥–∞—Ö
    budget_income BOOLEAN DEFAULT false,    -- –£—á–∏—Ç—ã–≤–∞—Ç—å –≤ –±—é–¥–∂–µ—Ç–µ –¥–æ—Ö–æ–¥–æ–≤
    budget_outcome BOOLEAN DEFAULT false,   -- –£—á–∏—Ç—ã–≤–∞—Ç—å –≤ –±—é–¥–∂–µ—Ç–µ —Ä–∞—Å—Ö–æ–¥–æ–≤
    
    -- –°—Ç–∞—Ç—É—Å –∏ —Å–∏—Å—Ç–µ–º–Ω—ã–µ –ø–æ–ª—è
    required BOOLEAN DEFAULT false,         -- –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π —Ç–µ–≥
    archive BOOLEAN DEFAULT false,          -- –ê—Ä—Ö–∏–≤–Ω—ã–π —Å—Ç–∞—Ç—É—Å
    static_id TEXT,                         -- –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π ID
    
    -- –í—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏
    changed TIMESTAMP WITH TIME ZONE,       -- –í—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
```

### –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

```sql
-- –û—Å–Ω–æ–≤–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã
CREATE INDEX idx_zm_tags_user_id ON zm_tags(user_id);
CREATE INDEX idx_zm_tags_parent_id ON zm_tags(parent_id);
CREATE INDEX idx_zm_tags_title ON zm_tags(title);
CREATE INDEX idx_zm_tags_archive ON zm_tags(archive);
CREATE INDEX idx_zm_tags_changed ON zm_tags(changed);
```

### –ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è (Views)

#### 1. `active_zm_tags`
–ê–∫—Ç–∏–≤–Ω—ã–µ (–Ω–µ –∞—Ä—Ö–∏–≤–Ω—ã–µ) —Ç–µ–≥–∏ –¥–ª—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è.

#### 2. `zm_tags_with_parent`
–¢–µ–≥–∏ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–º —ç–ª–µ–º–µ–Ω—Ç–µ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–µ—Ä–∞—Ä—Ö–∏–∏.

### –§—É–Ω–∫—Ü–∏–∏

#### 1. `get_child_tags(parent_tag_id UUID)`
–†–µ–∫—É—Ä—Å–∏–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –≤—Å–µ—Ö –¥–æ—á–µ—Ä–Ω–∏—Ö —Ç–µ–≥–æ–≤ —Å —É–∫–∞–∑–∞–Ω–∏–µ–º —É—Ä–æ–≤–Ω—è –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏.

#### 2. `get_parent_tags(child_tag_id UUID)`
–†–µ–∫—É—Ä—Å–∏–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –≤—Å–µ—Ö —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏—Ö —Ç–µ–≥–æ–≤ —Å —É–∫–∞–∑–∞–Ω–∏–µ–º —É—Ä–æ–≤–Ω—è –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏.

## üîÑ –ü—Ä–æ—Ü–µ—Å—Å –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö

### 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö

```javascript
// –ü—Ä–∏–º–µ—Ä –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ ZenMoney API
const transformTag = (zenmoneyTag) => ({
    id: zenmoneyTag.id,
    user_id: zenmoneyTag.user,
    title: zenmoneyTag.title,
    parent_id: zenmoneyTag.parent || null,
    color: zenmoneyTag.color,
    icon: zenmoneyTag.icon,
    picture: zenmoneyTag.picture,
    show_income: zenmoneyTag.showIncome,
    show_outcome: zenmoneyTag.showOutcome,
    budget_income: zenmoneyTag.budgetIncome,
    budget_outcome: zenmoneyTag.budgetOutcome,
    required: zenmoneyTag.required,
    archive: zenmoneyTag.archive,
    static_id: zenmoneyTag.staticId,
    changed: new Date(zenmoneyTag.changed * 1000).toISOString()
});
```

### 2. –ó–∞–≥—Ä—É–∑–∫–∞ –≤ Supabase

```javascript
// –ü—Ä–∏–º–µ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–µ–≥–æ–≤ –≤ Supabase
const loadTagsToSupabase = async (tags) => {
    const { data, error } = await supabase
        .from('zm_tags')
        .upsert(tags, { 
            onConflict: 'id',
            ignoreDuplicates: false 
        });
    
    if (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–µ–≥–æ–≤:', error);
        throw error;
    }
    
    return data;
};
```

## üìà –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

### 1. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ–ª–µ `changed` –¥–ª—è –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º–µ—Ö–∞–Ω–∏–∑–º –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏
- –£—á–∏—Ç—ã–≤–∞—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∑–æ–Ω—ã –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –º–µ—Ç–∫–∞–º–∏ –≤—Ä–µ–º–µ–Ω–∏

### 2. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –¥–ª—è —á–∞—Å—Ç–æ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –ö—ç—à–∏—Ä–æ–≤–∞—Ç—å –∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –∏–Ω–¥–µ–∫—Å–æ–≤

### 3. –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
- –ü—Ä–æ–≤–µ—Ä—è—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å UUID
- –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å —Ü–≤–µ—Ç–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è (0-4294967295)
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å null –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π

### 4. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å RLS (Row Level Security) –¥–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞
- –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–¥ –∑–∞–≥—Ä—É–∑–∫–æ–π
- –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –¥–∞–Ω–Ω—ã–º–∏

## üîß –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### 1. –ü–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫
```sql
-- –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–∞ –¥–ª—è –ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –ø–æ–∏—Å–∫–∞
CREATE INDEX idx_zm_tags_title_search 
ON zm_tags USING gin(to_tsvector('russian', title));
```

### 2. –ê–≥—Ä–µ–≥–∞—Ü–∏—è –ø–æ —Ü–≤–µ—Ç–∞–º
```sql
-- –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ —Ç–µ–≥–æ–≤ –ø–æ —Ü–≤–µ—Ç–∞–º
SELECT color, COUNT(*) as tag_count
FROM zm_tags
WHERE archive = false
GROUP BY color
ORDER BY tag_count DESC;
```

### 3. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–µ—Ä–∞—Ä—Ö–∏–∏
```sql
-- –ê–Ω–∞–ª–∏–∑ –≥–ª—É–±–∏–Ω—ã –∏–µ—Ä–∞—Ä—Ö–∏–∏ —Ç–µ–≥–æ–≤
WITH RECURSIVE tag_depth AS (
    SELECT id, title, 0 as depth
    FROM zm_tags
    WHERE parent_id IS NULL
    
    UNION ALL
    
    SELECT t.id, t.title, td.depth + 1
    FROM zm_tags t
    JOIN tag_depth td ON t.parent_id = td.id
)
SELECT depth, COUNT(*) as count
FROM tag_depth
GROUP BY depth
ORDER BY depth;
```

## üìù –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–°–æ–∑–¥–∞–Ω–Ω–∞—è —Å—Ö–µ–º–∞ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç:
- ‚úÖ –ü–æ–ª–Ω—É—é —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å API ZenMoney
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫—É –∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ç–µ–≥–æ–≤
- ‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã —á–µ—Ä–µ–∑ –∏–Ω–¥–µ–∫—Å—ã
- ‚úÖ –ì–∏–±–∫–æ—Å—Ç—å –¥–ª—è –±—É–¥—É—â–∏—Ö —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –º–µ—Ç–∫–∞–º–∏

–°—Ö–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –∏ –º–æ–∂–µ—Ç –±—ã—Ç—å —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç–∞ –≤ Supabase –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–µ–≥–∞–º–∏ –∏–∑ ZenMoney.

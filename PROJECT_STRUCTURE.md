# 📁 Структура проекта ZenMoney Telegram Bot

Этот файл описывает новую организованную структуру проекта после реорганизации.

## 🏗️ Корневая структура

```
pella_zenmoney_bot/
├── 📄 index.js                         # Главный файл запуска
├── 📄 package.json                     # Зависимости проекта
├── 📄 package-lock.json                # Фиксированные версии зависимостей
├── 📄 README.md                        # Основная документация
├── 📄 PROJECT_STRUCTURE.md             # Этот файл
│
├── 📁 archive/                         # Архивные файлы
│   ├── old_tests/                      # Старые тесты
│   └── old_todos/                      # Старые TODO списки
│
├── 📁 config/                          # Конфигурация
│   ├── env.example                     # Пример переменных окружения
│   └── docker/
│       └── Dockerfile                  # Docker конфигурация
│
├── 📁 database/                        # База данных
│   ├── schemas/                        # Схемы таблиц
│   │   ├── accounts.sql                # Схема таблицы счетов
│   │   ├── ai_settings.sql             # Схема настроек ИИ
│   │   ├── settings.sql                # Схема настроек
│   │   └── tags.sql                    # Схема тегов
│   ├── migrations/                     # Миграции БД
│   │   ├── 001_multi_user_schema.sql   # Многопользовательская схема
│   │   ├── 002_add_zm_user_id_column.sql # Добавление zm_user_id
│   │   └── 003_fix_uuid_schema.sql     # Исправление UUID схемы
│   └── utilities/                      # Утилиты БД
│       ├── drop_all_tables.sql         # Удаление всех таблиц
│       └── update_tags_color_type.sql  # Обновление типов цветов
│
├── 📁 docs/                            # Документация
│   ├── api/                            # API документация
│   │   ├── zenmoney_api_research.md    # Исследование ZenMoney API
│   │   ├── zenmoney_integration.md     # Интеграция с ZenMoney
│   │   └── zenmoney_transaction_structure.md # Структура транзакций
│   ├── analysis/                       # Анализ данных
│   │   ├── zenmoney_accounts_analysis.md # Анализ счетов
│   │   └── zenmoney_tags_analysis.md   # Анализ тегов
│   ├── migration/                      # Документация по миграции
│   │   ├── migration_todo.md           # TODO по миграции
│   │   └── multi_user_migration.md     # Многопользовательская миграция
│   ├── setup/                          # Настройка
│   │   ├── multi_user_setup.md         # Настройка многопользовательского режима
│   │   └── user_registration_flow.md   # Процесс регистрации пользователей
│   └── backlog.md                      # Бэклог проекта
│
├── 📁 scripts/                         # Скрипты
│   └── test_runners/                   # Тестовые скрипты
│       ├── test_taxi_transaction.js    # Тест транзакции такси
│       ├── test_zenmoney.js            # Тест ZenMoney API
│       └── test_zenmoney_operations.js # Тест операций ZenMoney
│
├── 📁 src/                             # Исходный код
│   ├── ai/                             # ИИ модуль
│   │   ├── analyzer.js                 # Анализатор сообщений
│   │   └── client.js                   # Клиент ИИ
│   │
│   ├── bot/                            # Telegram бот
│   │   ├── main.js                     # Основной файл бота
│   │   ├── handlers/                   # Обработчики
│   │   │   ├── commands.js             # Обработчики команд
│   │   │   ├── messages.js             # Обработчики сообщений
│   │   │   └── voice.js                # Обработчики голосовых сообщений
│   │   └── middleware/                 # Промежуточное ПО
│   │       └── auth.js                 # Авторизация
│   │
│   ├── database/                       # Клиенты БД
│   │   └── supabase/
│   │       └── client.js               # Клиент Supabase
│   │
│   ├── message/                        # Обработка сообщений
│   │   ├── parser.js                   # Парсер сообщений
│   │   └── unified.js                  # Единые сообщения
│   │
│   ├── utils/                          # Утилиты
│   │   ├── formatters.js               # Форматирование текста
│   │   └── validators.js               # Валидация данных
│   │
│   └── zenmoney/                       # ZenMoney API
│       ├── api.js                      # API клиент
│       └── transaction.js              # Работа с транзакциями
│
└── 📁 tests/                           # Тесты
    └── fixtures/                       # Тестовые данные
        ├── zenmoney_dictionaries.json  # Словари ZenMoney
        └── zenmoney_response.json      # Ответы ZenMoney API
```

## 🎯 Основные улучшения

### 1. **Логическая группировка**
- **`database/`** - вся работа с БД в одном месте
- **`src/bot/`** - логика Telegram бота изолирована
- **`docs/`** - документация структурирована по темам
- **`tests/`** - тесты и фикстуры организованы

### 2. **Модульная архитектура**
- **Обработчики** разбиты по типам (команды, сообщения, голос)
- **Утилиты** вынесены в отдельные модули
- **Middleware** для переиспользуемой логики
- **Валидаторы** и **форматеры** изолированы

### 3. **Улучшенная навигация**
- Четкое разделение по функциональности
- Понятные названия папок и файлов
- Логическая иерархия документации
- Структурированные миграции БД

## 🚀 Преимущества новой структуры

### ✅ **Для разработчиков**
- **Быстрый поиск** нужного кода
- **Легкое добавление** новых функций
- **Понятная архитектура** для новых участников
- **Изолированные модули** для тестирования

### ✅ **Для проекта**
- **Масштабируемость** - легко расширять функционал
- **Поддержка** - понятная структура для исправлений
- **Документация** - все материалы в логичном порядке
- **Деплой** - конфигурация изолирована

### ✅ **Для качества кода**
- **Разделение ответственности** между модулями
- **Переиспользование** общих утилит
- **Тестируемость** отдельных компонентов
- **Читаемость** за счет небольших файлов

## 📝 Рекомендации по использованию

### Добавление новых функций
1. **Команды бота** → `src/bot/handlers/commands.js`
2. **Обработка сообщений** → `src/bot/handlers/messages.js`
3. **Утилиты** → `src/utils/`
4. **Работа с БД** → `database/schemas/` или `database/migrations/`
5. **Документация** → соответствующая папка в `docs/`

### Тестирование
1. **Unit тесты** → `tests/unit/`
2. **Integration тесты** → `tests/integration/`
3. **Тестовые данные** → `tests/fixtures/`
4. **Скрипты тестирования** → `scripts/test_runners/`

### Конфигурация
1. **Docker** → `config/docker/`
2. **Переменные окружения** → `config/env.example`
3. **Настройки проекта** → корневые файлы

## 🔧 Миграция завершена

Все файлы успешно перемещены в новую структуру:
- ✅ SQL файлы организованы по категориям
- ✅ Документация структурирована по темам  
- ✅ Код бота разбит на модули
- ✅ Утилиты и валидаторы выделены
- ✅ Тесты и фикстуры организованы
- ✅ Конфигурация изолирована

Проект готов к дальнейшей разработке! 🚀
